<% function formatDate(date) { %>
    <%= new Date(date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %>
<% } %>

<div class="px-4 sm:px-6 lg:px-8 py-8 w-full max-w-[96rem] mx-auto">

    <!-- Page header -->
    <div class="sm:flex sm:justify-between sm:items-center mb-5">

        <!-- Left: Title -->
        <div class="mb-4 sm:mb-0">
            <h1 class="text-2xl md:text-3xl text-gray-800 dark:text-gray-100 font-bold">My Services</h1>
        </div>

        <!-- Right: Actions -->
        <div class="grid grid-flow-col sm:auto-cols-max justify-start sm:justify-end gap-2">

            <!-- Search form -->
            <form class="relative">
                <label for="action-search" class="sr-only">Search</label>
                <input id="action-search" class="form-input pl-9 bg-white dark:bg-gray-800" type="search" placeholder="Search…" />
                <button class="absolute inset-0 right-auto group" type="submit" aria-label="Search">
                    <svg class="shrink-0 fill-current text-gray-400 dark:text-gray-500 group-hover:text-gray-500 dark:group-hover:text-gray-400 ml-3 mr-2" width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7 14c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7zM7 2C4.243 2 2 4.243 2 7s2.243 5 5 5 5-2.243 5-5-2.243-5-5-5z" />
                        <path d="M15.707 14.293L13.314 11.9a8.019 8.019 0 01-1.414 1.414l2.393 2.393a.997.997 0 001.414 0 .999.999 0 000-1.414z" />
                    </svg>
                </button>
            </form>

            <!-- Add Services button -->
<label id="openModalBtn" class="btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white cursor-pointer px-4 py-2 rounded-lg flex items-center gap-2">
    <svg class="fill-current shrink-0 xs:hidden" width="16" height="16" viewBox="0 0 16 16">
        <path d="M15 7H9V1c0-.6-.4-1-1-1S7 .4 7 1v6H1c-.6 0-1 .4-1 1s.4 1 1 1h6v6c0 .6.4 1 1 1s1-.4 1-1V9h6c.6 0 1-.4 1-1s-.4-1-1-1z" />
    </svg>
    <span class="max-xs:sr-only">Add Service</span>
</label>




        </div>

    </div>

    <!-- Filters -->
    <div class="mb-5">
        <ul class="flex flex-wrap -m-1">
            <li class="m-1">
                <button class="inline-flex items-center justify-center text-sm font-medium leading-5 rounded-full px-3 py-1 border border-transparent shadow-xs bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-800 transition">View All</button>
            </li>
            <li class="m-1">
                <button class="inline-flex items-center justify-center text-sm font-medium leading-5 rounded-full px-3 py-1 border border-gray-200 dark:border-gray-700/60 hover:border-gray-300 dark:hover:border-gray-600 shadow-xs bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400 transition">Online</button>
            </li>
            <li class="m-1">
                <button class="inline-flex items-center justify-center text-sm font-medium leading-5 rounded-full px-3 py-1 border border-gray-200 dark:border-gray-700/60 hover:border-gray-300 dark:hover:border-gray-600 shadow-xs bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400 transition">Local</button>
            </li>
            <li class="m-1">
                <button class="inline-flex items-center justify-center text-sm font-medium leading-5 rounded-full px-3 py-1 border border-gray-200 dark:border-gray-700/60 hover:border-gray-300 dark:hover:border-gray-600 shadow-xs bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400 transition">This Week</button>
            </li>
            <li class="m-1">
                <button class="inline-flex items-center justify-center text-sm font-medium leading-5 rounded-full px-3 py-1 border border-gray-200 dark:border-gray-700/60 hover:border-gray-300 dark:hover:border-gray-600 shadow-xs bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400 transition">This Month</button>
            </li>
            <li class="m-1">
                <button class="inline-flex items-center justify-center text-sm font-medium leading-5 rounded-full px-3 py-1 border border-gray-200 dark:border-gray-700/60 hover:border-gray-300 dark:hover:border-gray-600 shadow-xs bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400 transition">Following</button>
            </li>
        </ul>                    
    </div>
    <div class="text-sm text-gray-500 dark:text-gray-400 italic mb-4"># Services</div>

    <!-- Content -->
    <div class="grid xl:grid-cols-2 gap-6 mb-8">

        <!-- Item 1 -->
         
         <% if (myServices && myServices.length > 0) { %>
            <% myServices.forEach(function(service) { %> 
                <article class="flex bg-white dark:bg-gray-800 shadow-xs rounded-xl overflow-hidden relative">
                    <!-- Edit button (top-right) -->
                    <div id="edit-<%- service._id %>" class="serviceEdit absolute mt-2 top-1 right-1 z-10 bg-gray-900 p-1 rounded-full hover:bg-gray-700 cursor-pointer"
                        data-id="<%- service._id %>" data-title="<%- service.title %>" data-description="<%- service.description %>" data-status="<%- service.status %>"  data-features="<%- service.features %>" data-classType="<%- service.classType %>" data-skills="<%- service.skills %>" data-priority="<%- service.priority %>" data-url="<%- service.url %>" data-imgUrl="<%- service.imgUrl %>"
                        >
                        <svg class="h-6 w-6 text-gray-50" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z"/>
                            <path d="M9 7 h-3a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-3" />
                            <path d="M9 15h3l8.5 -8.5a1.5 1.5 0 0 0 -3 -3l-8.5 8.5v3" />
                            <line x1="16" y1="5" x2="19" y2="8" />
                        </svg>
                    </div>
                    <!-- Image -->
                    <a class="relative block w-24 sm:w-56 xl:sidebar-expanded:w-40 2xl:sidebar-expanded:w-56 shrink-0" href="/admin/my-service/<%- service._id %>">
                        <img class="absolute object-cover object-center w-full h-full" src="<%- service.imgUrl %>" width="220" height="236" alt="Service" />
                        <!-- Like button -->
                        <button class="absolute top-0 right-0 mt-4 mr-4">
                            <div class="text-gray-100 bg-gray-900/60 rounded-full">
                                <span class="sr-only">Like</span>
                                <svg class="h-8 w-8 fill-current" viewBox="0 0 32 32">
                                    <path d="M22.682 11.318A4.485 4.485 0 0019.5 10a4.377 4.377 0 00-3.5 1.707A4.383 4.383 0 0012.5 10a4.5 4.5 0 00-3.182 7.682L16 24l6.682-6.318a4.5 4.5 0 000-6.364zm-1.4 4.933L16 21.247l-5.285-5A2.5 2.5 0 0112.5 12c1.437 0 2.312.681 3.5 2.625C17.187 12.681 18.062 12 19.5 12a2.5 2.5 0 011.785 4.251h-.003z" />
                                </svg>
                            </div>
                        </button>
                    </a>
                    <!-- Content -->
                    <div class="grow p-5 flex flex-col">
                        <div class="grow">
                            <div class="text-sm font-semibold text-violet-500 uppercase mb-2"><%- formatDate ? formatDate(service.createdAt) : service.createdAt %></div>
                            <a class="inline-flex mb-2" href="meetups-post.html">
                                <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100"><%- service.title %></h3>
                            </a>
                            <div class="text-sm">
                                <%- service.description.length > 50 ? service.description.substring(0, 50) + '...' : service.description %>
                            </div>                            
                        </div>
                        <!-- Footer -->
                        <div class="flex justify-between items-center mt-3">
                            <!-- Tag -->
                            <div class="text-xs inline-flex items-center font-medium border border-gray-200 dark:border-gray-700/60 text-gray-600 dark:text-gray-400 rounded-full text-center px-2.5 py-1">
                                <svg class="w-4 h-3 fill-gray-400 dark:fill-gray-500 mr-2" viewBox="0 0 16 12">
                                    <path d="m16 2-4 2.4V2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7.6l4 2.4V2ZM2 10V2h8v8H2Z" />
                                </svg>
                                <span>Online Event</span>
                            </div>
                            <!-- Avatars -->
                            <div class="flex items-center space-x-2">
                                <div class="flex -space-x-3 -ml-0.5">
                                    <img class="rounded-full border-2 border-white dark:border-gray-800 box-content" src="../../../../../public/content/images-admin/avatar-01.jpg" width="28" height="28" alt="User 01" />
                                    <img class="rounded-full border-2 border-white dark:border-gray-800 box-content" src="../../../../../public/content/images-admin/avatar-04.jpg" width="28" height="28" alt="User 04" />
                                    <img class="rounded-full border-2 border-white dark:border-gray-800 box-content" src="../../../../../public/content/images-admin/avatar-05.jpg" width="28" height="28" alt="User 05" />
                                </div>
                                <div class="text-xs font-medium text-gray-400 dark:text-gray-500 italic">+22</div>
                            </div>
                        </div>
                    </div>
                </article>
            <% }); %>
        <% } else { %>
            <p class="text-center text-gray-600 dark:text-gray-300">No Services found.</p>
        <% } %>        
       


    </div>
    
    <!-- Pagination -->
    <div class="mt-8">
        <div class="flex justify-center">
            <nav class="flex" role="navigation" aria-label="Navigation">
                <div class="mr-2">
                    <span class="inline-flex items-center justify-center rounded-lg leading-5 px-2.5 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700/60 text-gray-300 dark:text-gray-600">
                        <span class="sr-only">Previous</span><wbr />
                        <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16">
                            <path d="M9.4 13.4l1.4-1.4-4-4 4-4-1.4-1.4L4 8z" />
                        </svg>
                    </span>
                </div>
                <ul class="inline-flex text-sm font-medium -space-x-px rounded-lg shadow-xs">
                    <li>
                        <span class="inline-flex items-center justify-center rounded-l-lg leading-5 px-3.5 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700/60 text-violet-500">1</span>
                    </li>
                    <li>
                        <a class="inline-flex items-center justify-center leading-5 px-3.5 py-2 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-900 border border-gray-200 dark:border-gray-700/60 text-gray-600 dark:text-gray-300" href="#0">2</a>
                    </li>
                    <li>
                        <a class="inline-flex items-center justify-center leading-5 px-3.5 py-2 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-900 border border-gray-200 dark:border-gray-700/60 text-gray-600 dark:text-gray-300" href="#0">3</a>
                    </li>
                    <li>
                        <span class="inline-flex items-center justify-center leading-5 px-3.5 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700/60 text-gray-400 dark:text-gray-500">…</span>
                    </li>
                    <li>
                        <a class="inline-flex items-center justify-center rounded-r-lg leading-5 px-3.5 py-2 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-900 border border-gray-200 dark:border-gray-700/60 text-gray-600 dark:text-gray-300" href="#0">9</a>
                    </li>
                </ul>
                <div class="ml-2">
                    <a href="#0" class="inline-flex items-center justify-center rounded-lg leading-5 px-2.5 py-2 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-900 border border-gray-200 dark:border-gray-700/60 text-violet-500 shadow-xs">
                        <span class="sr-only">Next</span><wbr />
                        <svg class="fill-current" width="16" height="16" viewBox="0 0 16 16">
                            <path d="M6.6 13.4L5.2 12l4-4-4-4 1.4-1.4L12 8z" />
                        </svg>
                    </a>
                </div>
            </nav>
        </div>
    </div>

</div>





<!-- Modal Overlay (Hidden by Default) -->
<div id="modalOverlay" class="fixed z-40 inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden flex justify-center items-center z-40">

    <!-- Modal Window -->
    <div class="bg-white dark:bg-gray-900 p-6 rounded-lg shadow-lg max-w-2xl w-full border-2 border-white z-50">
        <h2 id="action-header" class="text-xl font-semibold mb-4 text-white dark:text-gray-200">Add a New Service</h2>

        <!-- Form -->
        <form id="serviceForm">
            <div class="space-y-3">
                <input type="hidden" id="id" name="id">
                <input type="text" id="title" name="title" placeholder="Service Title" class="w-full p-2 border rounded-md dark:bg-gray-800 dark:text-white">
                <textarea id="description" name="description" placeholder="Service Description" class="w-full p-2 border rounded-md dark:bg-gray-800 dark:text-white"></textarea>
                <input type="text" id="status" name="status" placeholder="Status" class="w-full p-2 border rounded-md dark:bg-gray-800 dark:text-white">
                <input type="text" id="skills" name="skills" placeholder="Skills (comma separated)" class="w-full p-2 border rounded-md dark:bg-gray-800 dark:text-white">
                <input type="text" id="features" name="features" placeholder="Features (comma separated)" class="w-full p-2 border rounded-md dark:bg-gray-800 dark:text-white">

                <select id="classType" name="classType" class="w-full p-2 border rounded-md dark:bg-gray-800 dark:text-white">
                    <option value="Web-App">Web-App</option>
                    <option value="Website">Website</option>
                    <option value="Mobile-App">Mobile-App</option>
                    <option value="Desktop-App">Desktop-App</option>
                </select>
                
                <input type="text" id="priority" name="priority" placeholder="Priority (Low, Medium, High)" class="w-full p-2 border rounded-md dark:bg-gray-800 dark:text-white">
                <input type="url" id="url" name="url" placeholder="Service URL" class="w-full p-2 border rounded-md dark:bg-gray-800 dark:text-white">
                <input type="url" id="imgUrl" name="imgUrl" placeholder="Image URL" class="w-full p-2 border rounded-md dark:bg-gray-800 dark:text-white">
            </div>

            <!-- Buttons -->
            <div class="mt-4 flex justify-end space-x-2">
                <button id="delete-project-button" type="button" class="hover:cursor-pointer px-4 py-2 bg-red-500 dark:bg-red-700 text-white dark:text-gray-100 rounded-md hover:bg-gray-400 hidden">Delete</button>
                <button type="button" id="closeModalBtn" class="hover:cursor-pointer px-4 py-2 bg-red-500 dark:bg-gray-700 border border-red-600 rounded-lg text-white dark:text-gray-200 rounded-md hover:bg-red-400">Cancel</button>
                <button type="submit" class="hover:cursor-pointer px-4 py-2 bg-blue-600 dark:bg-blue-700 border border-blue-500 rounded-lg text-white dark:text-white hover:bg-blue-700 dark:hover:bg-blue-800">
                    Save
                </button>            
            </div>
        </form>
    </div>
</div>

<!-- JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    const openModalBtn = document.getElementById('openModalBtn');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const modalOverlay = document.getElementById('modalOverlay');
    const serviceForm = document.getElementById('serviceForm');
    const serviceDeleteButton = document.getElementById('delete-service-button');
    const actionHeader = document.getElementById('action-header');

    // Open modal
    openModalBtn.addEventListener('click', () => {
        modalOverlay.classList.remove('hidden');
        serviceForm.reset();
        actionHeader.textContent = 'Add a New Service';
    });

    document.querySelectorAll('.serviceEdit').forEach(button => {
    button.addEventListener('click', function () {
        serviceForm.reset();
        // Show the modal
        document.getElementById('modalOverlay').classList.remove('hidden');
        serviceDeleteButton.classList.remove('hidden');
        serviceDeleteButton.addEventListener('click', () => {
            ajaxPostDeleteservice(this.getAttribute('data-id'));
        });
        // Get data attributes
        const attributes = ['id', 'title', 'description', 'skills',, 'classType', 'features', 'status', 'priority', 'url', 'imgUrl'];
        actionHeader.textContent = `Edit Service: ${this.getAttribute('data-title')}`;

        attributes.forEach(attr => {
            const inputField = document.getElementById(attr);
            if (inputField) {
                inputField.value = this.getAttribute('data-' + attr) || '';
            }
        });
    });
});

    // Close modal on button click
    closeModalBtn.addEventListener('click', () => {
        modalOverlay.classList.add('hidden');
        serviceDeleteButton.classList.add('hidden');
    });

    // Close modal when clicking outside the modal content
    // modalOverlay.addEventListener('click', (event) => {
    //     if (event.target === modalOverlay) {
    //         modalOverlay.classList.add('hidden');
    //         serviceDeleteButton.classList.add('hidden');
    //     }
    // });

    // Handle form submission with AJAX
    serviceForm.addEventListener('submit', async (event) => {
        event.preventDefault();

        // Get form data
        const formData = {
            id: document.getElementById('id').value,
            edit: false,
            delete: false,
            title: document.getElementById('title').value,
            description: document.getElementById('description').value,
            skills: document.getElementById('skills').value,
            classType: document.getElementById('classType').value,
            features: document.getElementById('features').value,
            status: document.getElementById('status').value,
            priority: document.getElementById('priority').value,
            url: document.getElementById('url').value,
            imgUrl: document.getElementById('imgUrl').value,
        };
        if (formData.id !== '') {
            formData.edit = true;
        }

        try {
            const response = await fetch('/admin/my-Services/action', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData),
            });

            if (response.ok) {
                if (formData.edit === true) {
                    alert('Service updated successfully!');
                } else {
                    alert('Service added successfully!');
                }
                modalOverlay.classList.add('hidden'); // Close modal
                serviceDeleteButton.classList.add('hidden');
                serviceForm.reset(); // Reset form
                window.location.reload(); // Refresh page
            } else {
                alert('Failed to add service. Please try again.');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
        }
    });
});

function ajaxPostDeleteservice(id) {
    if (confirm('Are you sure you want to delete this service?')) {
        fetch('/admin/my-Services/action', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ id, remove : true }),
        })
            .then(response => {
                if (response.ok) {
                    alert('Service deleted successfully!');
                    window.location.reload();
                } else {
                    alert('Failed to delete service. Please try again.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            });
    }
}
</script>